---
const {strength} = Astro.props;
const animateInDuration = "2s";
const animateInEase = "ease-in-out";

const transformYStyle = `${100 * strength}%`;
---
<style define:vars={{animateInDuration, animateInEase, transformYStyle}}>
    .parallax-layer {
        transform: translate3d(0, 0, 0);
        animation: animateIn var(--animateInDuration) var(--animateInEase);
    }
</style>
<div class="parallax-layer absolute top-0 bottom-0 right-0 left-0 overflow-hidden"
     data-parallax-layer-strength={strength}>
    <slot/>
</div>
<script>
    const parallaxLayers = Array.from(document.querySelectorAll('.parallax-layer') as NodeListOf<HTMLElement>
    ).map((node) => ({
        node,
        strength: Number(node.getAttribute('data-parallax-layer-strength'))
    }));

    function animateParallaxLayers(scrollY: number) {
        parallaxLayers.forEach((layer) => {
            const transformY = scrollY * layer.strength;
            layer.node.style.transform = `translate3d(0, -${transformY}px, 0)`;
        });
    }

    window.addEventListener("scroll", (event) => {
        animateParallaxLayers(window.scrollY);
    }, {passive: true});
</script>
